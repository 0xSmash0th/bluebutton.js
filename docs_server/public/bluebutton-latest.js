/**
 * BlueButton.js
 */

// v.0.0.2


(function () {
var Core=function(){var e=function(c,a,b,d){c=c.getElementsByTagName(a);for(a=0;a<c.length;a++)if(c[a].getAttribute(b)===d)return c[a]};return{parseXML:function(c){if(!c||"string"!==typeof c)return console.log("Error: XML data is not a string"),null;var a;window.DOMParser?(parser=new DOMParser,a=parser.parseFromString(c,"text/xml")):(a=new ActiveXObject("Microsoft.XMLDOM"),a.async="false",a.loadXML(c));return a},tagAttrVal:e,template:function(c){return e(this,"templateId","root",c).parentElement},
tag:function(c){return this.getElementsByTagName(c)[0]},elsByTag:function(c){return this.getElementsByTagName(c)},attr:function(c){return this.getAttribute(c)},val:function(){return this.childNodes[0].nodeValue},parseDate:function(c){var a=c.substr(0,4),b=c.substr(4,2);c=c.substr(6,2);return new Date(a,b,c)}}}();var Allergies=function(){return{process:function(e){var c=[],a,b;a=e.template("2.16.840.1.113883.10.20.22.2.6.1");e=a.elsByTag("entry");for(var d=0;d<e.length;d++){b=e[d];a=b.template("2.16.840.1.113883.10.20.22.4.7").tag("code");var f=a.attr("displayName"),h=a.attr("code"),g=a.attr("codeSystem"),j=a.attr("codeSystemName");a=b.template("2.16.840.1.113883.10.20.22.4.7").tag("value");var k=a.attr("displayName"),l=a.attr("code");a.attr("codeSystem");var m=a.attr("codeSystemName");a=b.template("2.16.840.1.113883.10.20.22.4.9").tag("value");
var n=a.attr("displayName"),q=a.attr("code"),p=a.attr("codeSystem");a=b.template("2.16.840.1.113883.10.20.22.4.8").tag("value");var r=a.attr("displayName");a=b.tag("participant").tag("code");var s=a.attr("displayName"),t=a.attr("code"),u=a.attr("codeSystem"),v=a.attr("codeSystemName");a=b.template("2.16.840.1.113883.10.20.22.4.28").tag("value");a=a.attr("displayName");c.push({date:{value:null,low:null,high:null},observation_date:{low:null},name:f,code:h,code_system:g,code_system_name:j,status:a,severity:r,
reaction:{date:{low:null},name:n,code:q,code_system:p},reaction_type:{name:k,code:l,code_system:p,code_system_name:m},allergen:{name:s,code:t,code_system:u,code_system_name:v}})}return c}}}();var Demographics=function(){return{process:function(e){var c,a;c=e.template("2.16.840.1.113883.10.20.22.1.1");a=c.tag("patientRole");c=a.tag("patient").tag("name");e=c.tag("prefix").val();var b=c.tag("given").val(),d=c.tag("family").val();c=a.tag("patient");var f=c.tag("birthTime").attr("value"),h=c.tag("administrativeGenderCode").attr("displayName"),g=c.tag("maritalStatusCode").attr("displayName");c=a.tag("addr");var j=c.tag("streetAddressLine").val(),k=c.tag("city").val(),l=c.tag("state").val(),
m=c.tag("postalCode").val(),n=c.tag("country").val();c=a.tag("telecom");var q=c.attr("value");email=null;var p=a.tag("raceCode").attr("displayName"),r=a.tag("ethnicGroupCode").attr("displayName"),s=a.tag("religiousAffiliationCode").attr("displayName");c=a.tag("birthplace");var t=c.tag("state").val(),u=c.tag("postalCode").val(),v=c.tag("country").val();c=a.tag("guardian");var w=c.tag("code").attr("displayName"),x=c.tag("telecom").attr("value");c=c.tag("guardianPerson");var y=c.tag("given").val(),z=
c.tag("family").val();c=a.tag("guardian").tag("addr");var A=c.tag("streetAddressLine").val(),B=c.tag("city").val(),C=c.tag("state").val(),D=c.tag("postalCode").val(),E=c.tag("country").val();c=a.tag("providerOrganization");a=c.tag("name").val();var F=c.tag("telecom").attr("value"),G=c.tag("streetAddressLine").val(),H=c.tag("city").val(),I=c.tag("state").val(),J=c.tag("postalCode").val();c=c.tag("country").val();return{name:{prefix:e,given:b,family:d},dob:f,gender:h,marital_status:g,address:{street:j,
city:k,state:l,zip:m,country:n},phone:{home:q,work:null,mobile:null},email:email,race:p,ethnicity:r,religion:s,birthplace:{state:t,zip:u,country:v},guardian:{name:{given:y,family:z},relationship:w,address:{street:A,city:B,state:C,zip:D,country:E},phone:{home:x}},provider:{organization:a,phone:F,address:{street:G,city:H,state:I,zip:J,country:c}}}}}}();var Encounters=function(){return{process:function(e){var c=[],a,b;a=e.template("2.16.840.1.113883.10.20.22.2.22.1");e=a.elsByTag("entry");for(var d=0;d<e.length;d++){b=e[d];var f=b.tag("effectiveTime").attr("value");a=b.tag("code");var h=a.attr("displayName"),g=a.attr("code"),j=a.attr("codeSystem"),k=a.attr("codeSystemName"),l=a.attr("codeSystemVersion");a=b.tag("value");var m=a.attr("displayName"),n=a.attr("code"),q=a.attr("codeSystem");a=b.tag("translation");var p=a.attr("displayName"),r=a.attr("code"),
s=a.attr("codeSystem"),t=a.attr("codeSystemName");a=b.tag("performer").tag("code");var u=a.attr("displayName"),v=a.attr("code"),w=a.attr("codeSystem"),x=a.attr("codeSystemName");a=b.tag("participant");b=a.tag("code").attr("displayName");var y=a.tag("streetAddressLine").val(),z=a.tag("city").val(),A=a.tag("state").val(),B=a.tag("postalCode").val();a=a.tag("country").val();c.push({date:f,name:h,code:g,code_system:j,code_system_name:k,code_system_version:l,finding:{name:m,code:n,code_system:q},translation:{name:p,
code:r,code_system:s,code_system_name:t},performer:{name:u,code:v,code_system:w,code_system_name:x},location:{organization:b,street:y,city:z,state:A,zip:B,country:a}})}return c}}}();var Immunizations=function(){var e=Core.parseDate;return{process:function(c){var a=[],b,d;b=c.template("2.16.840.1.113883.10.20.22.2.2");c=b.elsByTag("entry");for(var f=0;f<c.length;f++){d=c[f];b=d.tag("effectiveTime");var h=e(b.attr("value"));b=d.template("2.16.840.1.113883.10.20.22.4.54").tag("code");var g=b.attr("displayName"),j=b.attr("code"),k=b.attr("codeSystem"),l=b.attr("codeSystemName");b=d.template("2.16.840.1.113883.10.20.22.4.54").tag("translation");var m=b.attr("displayName"),n=b.attr("code"),
q=b.attr("codeSystem"),p=b.attr("codeSystemName");b=d.tag("routeCode");var r=b.attr("displayName"),s=b.attr("code"),t=b.attr("codeSystem"),u=b.attr("codeSystemName");b=d.template("2.16.840.1.113883.10.20.22.4.20");d=b.tag("text").val();b=b.tag("code");var v=b.attr("displayName"),w=b.attr("code");b=b.attr("codeSystem");a.push({date:h,product:{name:g,code:j,code_system:k,code_system_name:l,translation:{name:m,code:n,code_system:q,code_system_name:p}},route:{name:r,code:s,code_system:t,code_system_name:u},
instructions:d,education_type:{name:v,code:w,code_system:b}})}return a}}}();var Labs=function(){var e=Core.parseDate;return{process:function(c){var a=[],b=[],d,f,h;d=c.template("2.16.840.1.113883.10.20.22.2.3.1");c=d.elsByTag("entry");for(var g=0;g<c.length;g++){f=c[g];d=f.tag("code");var j=d.attr("displayName"),k=d.attr("code"),l=d.attr("codeSystem"),m=d.attr("codeSystemName");f=f.elsByTag("component");for(g=0;g<f.length;g++){h=f[g];var n=e(h.tag("effectiveTime").attr("value"));d=h.tag("code");j=d.attr("displayName");k=d.attr("code");l=d.attr("codeSystem");m=d.attr("codeSystemName");
d=h.tag("value");h=d.attr("value");d=d.attr("unit");reference_high=reference_low=null;b.push({date:n,name:j,value:h,unit:d,code:k,code_system:l,code_system_name:m,reference:{low:reference_low,high:reference_high}})}a.push({name:j,code:k,code_system:l,code_system_name:m,results:b})}return a}}}();var Medications=function(){var e=Core.parseDate;return{process:function(c){var a=[],b,d;b=c.template("2.16.840.1.113883.10.20.22.2.1.1");c=b.elsByTag("entry");for(var f=0;f<c.length;f++){d=c[f];b=d.tag("effectiveTime");var h=e(b.tag("low").attr("value")),g=e(b.tag("high").attr("value"));b=d.tag("manufacturedProduct").tag("code");var j=b.attr("displayName"),k=b.attr("code"),l=b.attr("codeSystem");b=d.tag("manufacturedProduct").tag("translation");var m=b.attr("displayName"),n=b.attr("code"),q=b.attr("codeSystem"),
p=b.attr("codeSystemName"),r=d.tag("doseQuantity").attr("value");b=d.tag("rateQuantity");var s=b.attr("value"),t=b.attr("unit");b=d.tag("precondition").tag("value");var u=b.attr("displayName"),v=b.attr("code"),w=b.attr("codeSystem");b=d.template("2.16.840.1.113883.10.20.22.4.19").tag("value");var x=b.attr("displayName"),y=b.attr("code"),z=b.attr("codeSystem");b=d.tag("routeCode");var A=b.attr("displayName"),B=b.attr("code"),C=b.attr("codeSystem"),D=b.attr("codeSystemName");b=d.tag("participant").tag("code");
var E=b.attr("displayName"),F=b.attr("code"),G=b.attr("codeSystem"),H=b.attr("codeSystemName");b=d.tag("administrationUnitCode");var I=b.attr("displayName"),J=b.attr("code"),K=b.attr("codeSystem"),L=b.attr("codeSystemName");b=d.tag("performer");b=b.tag("name").val();a.push({effective_time:{low:h,high:g},product:{name:j,code:k,code_system:l,translation:{name:m,code:n,code_system:q,code_system_name:p}},dose_quantity:r,rate_quantity:{value:s,unit:t},precondition:{name:u,code:v,code_system:w},reason:{name:x,
code:y,code_system:z},route:{name:A,code:B,code_system:C,code_system_name:D},vehicle:{name:E,code:F,code_system:G,code_system_name:H},administration:{name:I,code:J,code_system:K,code_system_name:L},prescriber:{organization:b,person:null}})}return a}}}();var Plan=function(){return{process:function(e){var c=[];e=e.template("2.16.840.1.113883.10.20.22.2.10").elsByTag("entry");for(var a=0;a<e.length;a++)c.push({date:null,name:null,code:null,code_system:null});return c}}}();var Problems=function(){return{process:function(e){var c=[],a,b;a=e.template("2.16.840.1.113883.10.20.22.2.5");e=a.elsByTag("entry");for(var d=0;d<e.length;d++){b=e[d];a=b.tag("effectiveTime");var f=a.tag("low").attr("value"),h=a.tag("high").attr("value");a=b.template("2.16.840.1.113883.10.20.22.4.4").tag("code");var g=a.attr("displayName"),j=a.attr("code"),k=a.attr("codeSystem");a=b.template("2.16.840.1.113883.10.20.22.4.6");var l=a.tag("value").attr("displayName");a=b.template("2.16.840.1.113883.10.20.22.4.31");
a=parseInt(a.tag("value").attr("value"));c.push({date:{from:f,to:h},name:g,status:l,age:a,code:j,code_system:k})}return c}}}();var Procedures=function(){return{process:function(e){var c=[],a,b;a=e.template("2.16.840.1.113883.10.20.22.2.7");e=a.elsByTag("entry");for(var d=0;d<e.length;d++){b=e[d];a=b.tag("effectiveTime");var f=a.attr("value");a=b.tag("code");var h=a.attr("displayName"),g=a.attr("code"),j=a.attr("codeSystem");specimen_code_system=specimen_code=specimen_name=null;a=b.tag("performer");var k=a.tag("name").val(),l=a.tag("telecom").attr("value"),m=a.tag("streetAddressLine").val(),n=a.tag("city").val(),q=a.tag("state").val(),
p=a.tag("postalCode").val(),r=a.tag("country").val();a=b.tag("participant").tag("code");b=a.attr("displayName");var s=a.attr("code");a=a.attr("codeSystem");c.push({date:f,name:h,code:g,code_system:j,specimen:{name:specimen_name,code:specimen_code,code_system:specimen_code_system},performer:{organization:k,street:m,city:n,state:q,zip:p,country:r,phone:l},device:{name:b,code:s,code_system:a}})}return c}}}();var Vitals=function(){var e=Core.parseDate;return{process:function(c){var a=[],b=[],d,f,h;d=c.template("2.16.840.1.113883.10.20.22.2.4.1");c=d.elsByTag("entry");for(var g=0;g<c.length;g++){f=c[g];d=f.tag("effectiveTime");var j=e(d.attr("value"));f=f.elsByTag("component");for(g=0;g<f.length;g++){h=f[g];d=h.tag("code");var k=d.attr("displayName"),l=d.attr("code"),m=d.attr("codeSystem"),n=d.attr("codeSystemName");d=h.tag("value");h=d.attr("value");d=d.attr("unit");b.push({name:k,code:l,code_system:m,
code_system_name:n,value:h,unit:d})}a.push({date:j,results:b})}return a}}}();var BlueButton=function(e){var c=null,a={},c=Core.parseXML(e);e=c.getElementsByTagName("*");for(var b=0;b<e.length;b++)e[b].template=Core.template,e[b].tag=Core.tag,e[b].elsByTag=Core.elsByTag,e[b].attr=Core.attr,e[b].val=Core.val;c.template=Core.template;a.allergies=Allergies.process(c);a.demographics=Demographics.process(c);a.encounters=Encounters.process(c);a.immunizations=Immunizations.process(c);a.labs=Labs.process(c);a.medications=Medications.process(c);a.plan=Plan.process(c);a.problems=Problems.process(c);
a.procedures=Procedures.process(c);a.vitals=Vitals.process(c);e=[a.allergies,a.demographics,a.encounters,a.immunizations,a.labs,a.medications,a.plan,a.problems,a.procedures,a.vitals];for(b=0;b<e.length;b++)e[b].json=function(){return JSON.stringify(this,null,2)};return{data:a,xmlDOM:c,allergies:function(){return a.allergies},demographics:function(){return a.demographics},encounters:function(){return a.encounters},immunizations:function(){return a.immunizations},labs:function(){return a.labs},medications:function(){return a.medications},
plan:function(){return a.plan},problems:function(){return a.problems},procedures:function(){return a.procedures},vitals:function(){return a.vitals}}};window.BlueButton=BlueButton;
})();
